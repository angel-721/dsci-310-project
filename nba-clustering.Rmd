---
title: "nba-clustering"
author: "Angel Manuel Velasquez"
date: "2024-11-21"
output: html_notebook
---

# Clustering

## Load Packages and data
```{r echo = FALSE}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(gridExtra))
suppressPackageStartupMessages(library(ggcorrplot))

# Data Source: https://www.kaggle.com/datasets/owenrocchi/nba-advanced-stats-20022022
nba_stats_processed <- readRDS("nba_stats_processed.rds")
names <- readRDS("names.rds")
```

## This type clustering

### Process Data 
```{r echo = FALSE}

# remove Pos. 
nba_stats_final <- nba_stats_processed |> select(-Pos)

# First, define the feature columns using tidyselect helpers
feature_columns <- c("VORP", "DWS", "OWS")

# Then create the training data using these columns
nba_stats_final <- nba_stats_processed |> 
  select( all_of(feature_columns))

```

### Use elbow method

```{r echo = FALSE:w}
WCSS <- sapply(1:7, function(k) kmeans(nba_stats_final,k)$tot.withinss)

WCSS

ggplot() +
  geom_point(aes(x = 1:7, y = WCSS), cex = 4) +
  geom_line(aes(x = 1:7, y = WCSS)) +
  labs(x = "Number of clusters (k)", 
       y = "Within-cluster sum of squares (WCSS)") +
  theme(text = element_text(size = 20))
```

### Fit a k-means model
```{r echo = FALSE}
kmModel <- kmeans(nba_stats_final, 4)

nba_stats_processed$cluster <- as.factor(kmModel$cluster)

kmCenters <- as.data.frame(kmModel$centers)
nba_stats_processed$name <- names
```



### Visualize it
```{r echo = FALSE}
nba_stats_processed |> 
  ggplot(aes(x=VORP, y=DWS)) +
  geom_point(aes(color = cluster, shape = cluster), size=3) + 
  geom_point(data=kmCenters, aes(x=VORP, y=DWS), 
             color="black", size=10, shape = 18) +
  geom_text(aes(label = name), 
            size = 2, 
            vjust = -1, 
            check_overlap = TRUE) +
  labs(x='Value Over Replacement Player (VORP)', 
       y='Defensive Win Shares (DWS)', 
       title = 'NBA Player Clustering') +
  theme_minimal() +
  scale_color_manual(values = c("blue", "yellow", "pink", "red"), 
                     name = "Cluster")
```
